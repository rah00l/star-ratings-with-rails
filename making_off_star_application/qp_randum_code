class Product < ActiveRecord::Base  
    has_many :product_categories ,:dependent => :destroy
    has_many :categories, :through => :product_categories
end


class Category < ActiveRecord::Base

  has_many :product_categories
  has_many :products, :through => :product_categories
end


rails g model product_category 


class ProductCategory < ActiveRecord::belongs
  Base_to :product
  belongs_to :category
  validates_uniqueness_of :product_id, :scope => :category_id
end


class CreateProductCategories < ActiveRecord::Migration
 def self.up
    create_table :spree_product_categories, do |t|
      t.references :product
      t.references :category
    end
    add_index :spree_product_categories, [:product_id, :category_id]
    add_index :spree_product_categories, [:category_id, :product_id]
  end

  def self.down
    drop_table :spree_product_categories
  end
end
